
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Domain Driven Design principles with Symfony2 also for dummy applications</title>
    
    <meta name="description" content="The way we develop evolves">
    
    <meta name="author" content="Giulio De Donato">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="/assets/themes/readable-liuggio/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/themes/readable-liuggio/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/assets/themes/readable-liuggio/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/readable-liuggio/js/styles/github.css" rel="stylesheet">
    <link href="/assets/themes/readable-liuggio/js/uitotop-jquery-plugin.css" rel="stylesheet">
    <!-- Google Web Font-->
    <link href='http://fonts.googleapis.com/css?family=Lato:400,400italic,900italic,300' rel='stylesheet' type='text/css'>
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link rel="alternate" type="application/rss+xml" title="" href="http://welcometothebundle.com/feed.xml">

    <link rel="shortcut icon" href="/assets/themes/readable-liuggio/img/icon/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="/assets/themes/readable-liuggio/img/icon/apple-touch-icon-152x152.png" />

</head>
<body>
<div class="container">
    <header>
        <div id="header">
            <div class="logo span6"><img src="/assets/themes/readable-liuggio/img/welcometothebundle-logo.png"></div>
            <h2><a title="Blog of Giulio De Donato" id="sitename" href="http://www.welcometothebundle.com/">Welcome to the bundle</a></h2>  
            
            <p>Best Practices, Symfony2, developing, and blah blah blah.</p>
            
        </div>
    </header>
<!--[if lt IE 7]> <html class="no-js ie6 oldie" lang="en"> <![endif]-->
    <section id="content">
        <div class="row">
            <aside class="span3">
                <div class="well boxed profile">
                    <p align="center"><img
                            src="http://www.gravatar.com/avatar/662a52953053d94a145a00df9da9f0d2.png?size=48" class="img-rounded">
                    </p>
                    <p style="font-size:95%">I'm liuggio 
                    (aka <a href="https://plus.google.com/115690008178168800202?rel=author" rel="author" title="Giulio De Donato">Giulio De Donato</a>)
                         tons of lines of code ago I took a degree in Computer Science, I'm the
                        lead developer at Terravision. I can't stop studying, you could find me in some conferences, I'm a proud member of <a href="http://roma.grusp.org/">PHP user group</a>, 
                        and right now I'm in <a href="https://maps.google.it/maps?q=vatican+city&hnear=Vatican+City&gl=it&t=h&z=16">the center of Rome</a>.</p>
                        <p><strong>ps: I love open-source.</strong></p>
                </div>
                <!-- start sticky section
#################################################
                -->
                <div class="well social boxed">
                    <div class="center" align="center">
                        <a href="https://github.com/liuggio" title="Giulio De Donato github projects"
                           target="_blank"><img src="/assets/themes/readable-liuggio/img/github.png" width="32"></a>
                        <a href="http://twitter.com/liuggio" title="Giulio De Donato twitter page"
                           target="_blank"><i class="icon-twitter"></i></a>
                        <a href="http://www.linkedin.com/profile/view?id=94597934"
                           title="Giulio De Donato Linkedin profile" target="_blank">
                           <i class="icon-linkedin"></i></a>
                        <a href="http://www.slideshare.net/liuggio"
                           title="Giulio De Donato slideshare presentations" target="_blank">
                           <img src="/assets/themes/readable-liuggio/img/slide.png" width="32">
                           </a>
                    </div>
                    <div class="center">
                        <div align="center" class="twitter-cnt">
                            <a href="https://twitter.com/liuggio" class="twitter-follow-button"
                               data-show-count="false" data-size="large" data-dnt="true" title="Follow Giulio De Donato">Follow
                                @liuggio</a>
                            <script>!function (d, s, id) {
                                var js, fjs = d.getElementsByTagName(s)[0];
                                if (!d.getElementById(id)) {
                                    js = d.createElement(s);
                                    js.id = id;
                                    js.src = "//platform.twitter.com/widgets.js";
                                    fjs.parentNode.insertBefore(js, fjs);
                                }
                            }(document, "script", "twitter-wjs");</script>
                        </div>
                    </div>
                </div>

                <!-- end sticky section
                ================================================== -->
                <div class="boxed categories">
                    
                    <ul class="nav nav-tabs nav-stacked">
                        
                        


  
     
    	<li><a href="/categories.html#post-ref">
    		post
    	</a></li>
     
    	<li><a href="/categories.html#tutorial-ref">
    		tutorial
    	</a></li>
     
    	<li><a href="/categories.html#talk-ref">
    		talk
    	</a></li>
     
    	<li><a href="/categories.html#blah-blah-blah-ref">
    		blah-blah-blah
    	</a></li>
    
  


                    </ul>
                </div>
                
                <div class="boxed cloud">
                    <h3>Tags</h3>
                    <ul class="tag_box">
                        
                        


  
     
    	<li class="tag-list tag-size-2"><a href="/tags.html#assetic-ref" rel="2">assetic <span>2</span></a></li>
     
    	<li class="tag-list tag-size-11"><a href="/tags.html#symfony2-ref" rel="11">symfony2 <span>11</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#bundle-ref" rel="3">bundle <span>3</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#github-ref" rel="1">github <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#bitbucket-ref" rel="1">bitbucket <span>1</span></a></li>
     
    	<li class="tag-list tag-size-13"><a href="/tags.html#PHP-ref" rel="13">PHP <span>13</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#assets-ref" rel="3">assets <span>3</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#rackspace-ref" rel="1">rackspace <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#CDN-ref" rel="1">CDN <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#monitoring-ref" rel="1">monitoring <span>1</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#statsd-ref" rel="3">statsd <span>3</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#vagrant-ref" rel="1">vagrant <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#graphite-ref" rel="1">graphite <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#tvision-ref" rel="1">tvision <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#team-ref" rel="1">team <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#coding-ref" rel="1">coding <span>1</span></a></li>
     
    	<li class="tag-list tag-size-2"><a href="/tags.html#conference-ref" rel="2">conference <span>2</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#cache-ref" rel="3">cache <span>3</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#optimization-ref" rel="1">optimization <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#servergrove-ref" rel="1">servergrove <span>1</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#phpunit-ref" rel="3">phpunit <span>3</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#guard-ref" rel="1">guard <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#automate-ref" rel="1">automate <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#code-inspection-ref" rel="1">code-inspection <span>1</span></a></li>
     
    	<li class="tag-list tag-size-2"><a href="/tags.html#TDD-ref" rel="2">TDD <span>2</span></a></li>
     
    	<li class="tag-list tag-size-4"><a href="/tags.html#BDD-ref" rel="4">BDD <span>4</span></a></li>
     
    	<li class="tag-list tag-size-2"><a href="/tags.html#test-ref" rel="2">test <span>2</span></a></li>
     
    	<li class="tag-list tag-size-2"><a href="/tags.html#phpspec-ref" rel="2">phpspec <span>2</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#HTTP-ref" rel="1">HTTP <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#APC-ref" rel="1">APC <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#redis-ref" rel="1">redis <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#doctrine2-ref" rel="1">doctrine2 <span>1</span></a></li>
     
    	<li class="tag-list tag-size-2"><a href="/tags.html#doctrine-ref" rel="2">doctrine <span>2</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#php-internal-ref" rel="1">php-internal <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#interface-ref" rel="1">interface <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#design-patterns-ref" rel="1">design-patterns <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#talk-ref" rel="1">talk <span>1</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#rest-ref" rel="3">rest <span>3</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#api-ref" rel="3">api <span>3</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#DDD-ref" rel="3">DDD <span>3</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#value objects-ref" rel="1">value objects <span>1</span></a></li>
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#symfony-ref" rel="1">symfony <span>1</span></a></li>
    
  



                    </ul>
                </div>

                
                    <div id="related" class="boxed">
                    <h3>Related Posts</h3>
                    <ul class="posts">
                    
                    <li>
                      <a href="/best-resources-about-symfony-tdd-bdd-ddd-methologies">(my) Best resources about methodologies on Symfony, PHP, DDD, BDD ...</a>
                    </li>
                    
                    <li>
                      <a href="/persist-the-money-doctrine-value-object">Persist the Money, Doctrine Value Object</a>
                    </li>
                    
                    <li>
                      <a href="/symfony2-rest-api-the-best-way-part-3">part 3 - Symfony2 API: the rest of REST</a>
                    </li>
                    
                    <li>
                      <a href="/web-api-rest-with-symfony2-the-best-way-the-post-method">part2 - Web API REST with Symfony2</a>
                    </li>
                    
                    <li>
                      <a href="/symfony2-rest-api-the-best-2013-way">Symfony2 REST API: the best way</a>
                    </li>
                    
                    </ul>
                    </div>
                
            </aside>

            <!-- start content section
            ================================================== -->
            <div class="span9">
                

<div class="span9">
    <div class="page-header">
        <div class="row">
            <h1 class="span8">Domain Driven Design principles with Symfony2 also for dummy applications 
            </h1>
          <div class="span1 right bottom sticky center">
              
              <div id="edit-github">
                  <a class="btn btn-mini" target="_blank" href="https://github.com/liuggio/liuggio.github.com/blob/master/_posts/2014-04-29-domain-driven-design-and-symfony-for-simple-app.md" title="Found a typo? Please edit it on Github"><i class="icon-edit pull-left"></i><b>Fix</b></a>
              </div>
              

              <div id="sticky-pagination" class="hidden">
                  
                      <a class="btn-mini pull-left" target="_blank" href="/persist-the-money-doctrine-value-object" title="Persist the Money, Doctrine Value Object">
                          <i class="icon-arrow-left"></i>
                      </a>
                  

                  
                  <a class="btn-mini pull-right" target="_blank" href="/best-resources-about-symfony-tdd-bdd-ddd-methologies" title="(my) Best resources about methodologies on Symfony, PHP, DDD, BDD ...">
                      <i class="icon-arrow-right"></i>
                  </a>
                  
              </div>

               <a href="https://twitter.com/share" class="twitter-share-button" data-via="liuggio" data-size="large"
                  data-count="none">Tweet</a>
               <script>!function (d, s, id) {
                   var js, fjs = d.getElementsByTagName(s)[0];
                   if (!d.getElementById(id)) {
                       js = d.createElement(s);
                       js.id = id;
                       js.src = "//platform.twitter.com/widgets.js";
                       fjs.parentNode.insertBefore(js, fjs);
                   }
               }(document, "script", "twitter-wjs");</script>
           </div>
        </div>
        <hr>
        <div class="row">
            <div class="span4">
                <div class="date"><span>29 April 2014</span></div>
            </div>

            <div class="span5">
                
                <ul class="tag_box">
                    
                    


  
     
    	<li class="tag-list tag-size-1"><a href="/tags.html#symfony-ref">symfony <span>1</span></a></li>
     
    	<li class="tag-list tag-size-13"><a href="/tags.html#PHP-ref">PHP <span>13</span></a></li>
     
    	<li class="tag-list tag-size-4"><a href="/tags.html#BDD-ref">BDD <span>4</span></a></li>
     
    	<li class="tag-list tag-size-3"><a href="/tags.html#DDD-ref">DDD <span>3</span></a></li>
    
  



                </ul>
                
            </div>
        </div>
    </div>
    <article>
        <h3 id="part_1__the_new_flow_the_layered_architecture_and_the_entities">Part 1 - The new flow, the layered architecture and the entities.</h3>

<p>The objective of this series of articles is to show how and why I have changed the way of programming, I would also point to the benefits of adopting certain principles of Domain Driven Design also with simple applications, instead using DDD strictly might benefit only for some particular and complex Domains.</p>

<p>I do not want to say I am an evangelist of the Domain Driven Development philosophy, but the <a href="http://www.amazon.it/Implementing-Domain-Driven-Design-Vaughn-Vernon/dp/0321834577">red book of V.Vaughn</a> and the movement, has profoundly changed and improved the way I code today.</p>

<p>I’m sorry for this new trilogy :), I would like to be short and concise bringing practical examples, as always I love to say that I didn’t invent anything.</p>

<h2 id="history">History</h2>

<p>Around 2003/2004 I gave birth to a PHP framework that would help me on some small software, was a jumble of libraries stacked with copy and paste, starting from <a href="https://www.phpnuke.org/">php-nuke</a>. I released it on <a href="https://www.sourceforge.net">sourceforge</a> the project had many “include” and a few contributors, the name of the project is a secret, it was a youth error.</p>

<p>That was the first time I understood that the decoupling not occurs only at the class level, and the benefit of using a library for the template and a library for the database abstraction gave to me a new mindset, in the meanwhile Eric Evans was publishing <a href="http://www.amazon.it/gp/product/0321125215/ref=pd_lpo_sbs_dp_ss_1">the Blue Book</a> .</p>

<p>My programming style has changed, and I do not understand how music artists or painters keep their style for an entire career, even in the same version of Symfony my developing style changes and evolves.</p>

<p>To better understand how changed let’s start with a real example:</p>

<p>Stories:</p>

<ol>
<li>As Author I want to be able to write a new Blog-Post as draft.</li>

<li>Given a blog-post already written, as Author I want to be able to publish a new Blog-Post.</li>

<li>The Blog-Post is written by an Author with a title and a body.</li>

<li>When a blog post is written is not public.</li>

<li>As Author I want to see a list of my posts.</li>
</ol>

<h3 id="before_code_first_it_means_bundlefirst">Before: code first (it means bundle-first).</h3>

<p>If few years ago I’d thought to the database first, Symfony2 gave a breath of fresh pushing forward the mentality of modularity and decoupling.</p>

<p>It was explicit the good practice of not putting the logic inside the controllers, but as a side effect in the ecosystem has become quite common the ”<strong>bundle-everything with thin controllers and fat services</strong>”.</p>

<p>Services full of logic, and empty ORM entities (empty means only with setters and getters).</p>

<h3 id="thin_controllers_and_fat_services__smell">Thin Controllers and Fat Services = smell</h3>

<p>With a new project you start installing the symfony-standard, you create a bundle for each concept, then you create thousands of Doctrine2 entities (get and set on each property), and then you start testing the service before coding, then a slim controller and a functional test over the Reponse playing with HTML and css path in order to have green tests.</p>

<p>This way of doing it is not even too wrong, it does not suck, but adding new features you’d have a lot of interdependent Symfony bundles, many fat services (maybe) with abstract nouns such as ‘manager’, ‘service’, ‘handler’ and even a CoreBundle with the shared logic. Entities with getters, setters, but also full of annotations (doctrine and serializer).</p>

<p>The folders would have this structure:</p>

<pre><code>Symfony standard
├── BlogBundle
│    ├── Entity
│    │   └── Blog.php
│    │   └── BlogRepository.php
│    ├── Service
│    │   └── BlogService.php
│    │   └── BlogManager.php
│    │   └── BlogManipulator.php
│    │   └── BlogFactory.php
│    │   └── BlogHandler.php
│    └── Controller
│        └── BlogController.php
│    CoreBundle
│    ├── Entity
│    │   └── Currency.php
│    ├── Service
	 
...</code></pre>

<p>http://blog.codinghorror.com/i-shall-call-it-somethingmanager/</p>

<h4 id="something_wrong_and_anemic_domain_model">Something wrong and Anemic Domain Model</h4>

<p>A couple of years ago after a big project in Symfony2, I realized there was something that could be improved, too many bundles, too many entities persisted without a real value, too many connections, too many fat services, too much Symfony2-centric application, something had changed, and in the my PHP community began to appear articles from <a href="http://williamdurand.fr">williamdurand</a> and <a href="http://verraes.net/">Verraes</a> on how we could improve this pattern.</p>

<p>Connected bundles wasn’t the biggest problem, the system was suffering also of <a href="http://www.martinfowler.com/bliki/AnemicDomainModel.html">Anemic Domain Model</a>.</p>

<p>What is the problem of moving a lot of logic in the services?</p>

<p>A service should reside in the application layer should be small by definition:</p>
<blockquote>In general, the more behavior you find in the services, the more likely you are to be robbing yourself of the benefits of a domain model. If all your logic is in services, you've robbed yourself blind.<small>Martin Fowler</small></blockquote>
<h2 id="today">Today</h2>

<p>Today I develop in a different way, many more <a href="/persist-the-money-doctrine-value-object/">Value Objects</a>, Entities with more logic, I would start by specifying use cases, and above all the flow of development has changed.</p>

<p>Thinking first about objects that have to perform behaviors, protagonists of the use cases are domain entities (should not be confused with the doctrine-entity) and aggregates, the step of deciding how to persist should be sent to a later stage.</p>

<h3 id="layered_architecture">Layered Architecture</h3>

<p>The thing that mostly changed the way I develop is the separation of the various concerns of our application by isolating the expression of domain model and business logic, eliminate any dependency from the business logic.</p>

<p>For <a href="http://www.amazon.com/Pattern-Oriented-Software-Architecture-Volume-Patterns/dp/0471958697/ref=tmm_hrd_title_0?">Buschmann</a> there are 4 layers:</p>

<ol>
<li><strong>Domain Layer</strong>: the internal layer is where you have to define the outlines of the use cases</li>

<li><strong>Application Layer</strong>: the flow of the behavior</li>

<li><strong>User Interface layer</strong>: how to present to the user</li>

<li><strong>Infrastructure Layer</strong>: and finally how to implement them, the choice of the framework should be made in this final layer.</li>
</ol>

<p>At the beginning we do not want to think about how we will save our objects, we just want the use cases satisfied, we do not want to think about which framework we will use, we are in the <code>Domain Layer</code>.</p>
<blockquote>It doesn't depend on any particular UI or service interface-related technology, it just describes use cases.</blockquote>
<p>Let’s see specifically how to proceed in the development, starting from the use cases.</p>

<p>Install a BDD tool that helps you to write user stories:</p>

<pre><code>composer init
composer behat/behat &quot;2.4.*@stable&quot;
bin/behat --init</code></pre>

<p>So we start writing the business goal in <code>features/post.feature</code></p>

<pre><code> Scenario: Write a new blog Post
    Given I am an Author
    When I fill in the following:
      |  First Post | Great Description |
    Then the &quot;First Post&quot; post should be written.

  Scenario: Publish a blog Post
    Given I am an Author
    And I wrote a post with &quot;First Post&quot; and &quot;Great Description&quot; as description
    When I publish the post with the title &quot;First Post&quot;
    Then the &quot;First Post&quot; post should be public.

  Scenario: List of all my posts
    Given I am an Author
    And I wrote the following posts:
      |  First Post | Great Description |
      |  Second Post | Bad Description |
    When I see the list of all my posts
    Then the &quot;First Post&quot; and the &quot;Second Post&quot; should be shown.</code></pre>

<p>So we have completed the outside specification, now we could go deep inside with <code>phpspec</code> describing the behaviours of our domain.</p>

<p>We have recognized 2 entities <code>Post</code> and <code>Author</code> they didn’t change together so they are 2 different concepts, they are <code>Entity</code> and not value objects because they could change, and they have a lifecycle, and we do want to identify an Author or a Post.</p>

<p>Install the tool that helps you to design focusing on the behaviors:</p>

<pre><code>composer require &quot;phpspec/phpspec&quot; &quot;~2.0&quot;
bin/phpspec describe Liuggio/Blog/Post</code></pre>

<h3 id="post_behaviours">Post behaviours</h3>

<p>We want to describe how the <code>Post</code> entity will works before writing the code:</p>

<h5 id="the_blogpost_is_written_by_an_author_with_a_title_and_a_body">The Blog-Post is written by an Author with a title and a body.</h5>

<p>describing the specification in <code>spec/postSpec.php</code>:</p>

<pre><code>function it_should_be_written_by_an_author_containing_a_title_and_body()
{
}

function it_should_be_written_as_drafted()
{
}

function it_should_be_published()
{
}</code></pre>

<p>Running phpspec you will have:</p>

<pre><code>$ bin/phpspec  run --format=pretty
  post
10  - should be written by an author containing a title and a body
    todo: write pending example
14  - should be written as drafted
    todo: write pending example
18  - should be published
    todo: write pending example
1 specs
3 examples (3 pending)
2ms</code></pre>

<p>What is obvious from the first specification? we need an <code>Author</code> object.</p>

<pre><code>bin/phpspec describe Liuggio/Blog/Author</code></pre>

<p>and then in <code>spec/Liuggio/Blog/AuthorSpec.php</code></p>

<pre><code>function it_should_always_have_a_nickname($nickname)
{
    $this-&gt;beConstructedWith($nickname);
    $this-&gt;shouldHaveType('Liuggio\Blog\Author');
}</code></pre>

<p>Running <code>bin/phpspec  run --format=pretty</code></p>

<p>We are going to create the BlogAuthor:</p>

<pre><code>class Author
{
    private $nickname;

    function __construct($nickname)
    {
        $this-&gt;nickname = $nickname;
    }</code></pre>

<p>We prefer to have in the constructor <code>$nickname</code>, in this way we are protecting the Entity <code>Author</code> to be consistent by specification (nickname could also be a Value Object).</p>

<p>Back to our Blog specifications we could add here the Author <code>spec/Liuggio/Blog/PostSpec.php</code></p>

<pre><code>function it_should_be_written_by_an_author_containing_a_title_and_body(Author $author)
{
    $this-&gt;beConstructedWith($author, 'title', 'body');
    $this-&gt;shouldHaveType('Liuggio\Blog\Post');
}</code></pre>

<p>Then we write our Post Entity Class.</p>

<pre><code>class Post
{
    private $author;
    private $text;
    private $body;

    function __construct(Author $author, $text, $body)
    ...</code></pre>

<p>What changed is that we don’t care here about Doctrine and Identity, we care only about the behaviour.</p>

<h5 id="when_a_blog_post_is_written_is_not_public">When a blog post is written is not public</h5>

<p>We have to add an object that represents the state of the post, we are going to use a Value Object.</p>

<p>Although there are several libraries to work with Finite State Machine, maybe a simple value object in this case may be perfect.</p>

<p>As always, we start from the specifications to get an object that represents the states of Drafted and Published.</p>

<p><code>spec/Liuggio/Blog/PostSpec.php</code></p>

<pre><code>function it_should_be_written_as_drafted()
{
    $this-&gt;isPublic()-&gt;shouldBe(false);
}</code></pre>

<p>We are describing the behavior we expect the entity Post, and we put this rule in the constructor into <code>\Liuggio\Blog\Post</code>:</p>

<pre><code>class Post
{
	// ..
    public function __construct(Author $author, $title, $body)
    {
        $this-&gt;author = $author;
        $this-&gt;title = $title;
        $this-&gt;body = $body;
        $this-&gt;state = State::draft();
        $this-&gt;createdAt = new \Datetime(&quot;now&quot;);
    }</code></pre>

<h5 id="the_blogpost_could_be_published">The Blog-Post could be published.</h5>

<p><code>spec/Liuggio/Blog/PostSpec.php</code></p>

<pre><code>function it_should_be_published()
{
    $this-&gt;publish();
    $this-&gt;isPublic()-&gt;shouldBe(true);
}

function it_should_raise_exception_during_publish_if_it_was_already_public()
{
    $this-&gt;publish();
    $this-&gt;shouldThrow('Exception')-&gt;duringPublish();
}</code></pre>

<p>We have reached a point where our entity <code>Post</code> will be like:</p>

<pre><code>class Post
{
    //...

    public function isPublic()
    {
        return $this-&gt;state-&gt;isPublic();
    }

    public function publish()
    {
        if (!$this-&gt;couldBePublished()) {
            throw new \Exception(&quot;Could not do this transition&quot;);
        }

        return $this-&gt;state = State::published();
    }

    private function couldBePublished()
    {
        return !$this-&gt;isPublic();
    }</code></pre>

<p>The folder is now:</p>

<pre><code>My-Domain-Driven-Blog
	├── spec
	│   └── Liuggio
	│       └── Blog
	├── src
	│   └── Blog
	│       ├── Author.php
	│       ├── Post.php
	│       └── State.php</code></pre>

<h2 id="the_github_repository">The github repository</h2>

<p>There’s a repository at <a href="https://github.com/liuggio/DDD-dummy-blog-with-symfony2/">liuggio/DDD-dummy-blog-with-symfony2</a> you could see the working code using the tag <code>part-1</code> with:</p>

<pre><code>git clone liuggio/DDD-dummy-blog-with-symfony2
cd DDD-dummy-blog-with-symfony2
composer install
git checkout -f part-1</code></pre>

<p>All the tags for the demo project at <a href="https://github.com/liuggio/DDD-dummy-blog-with-symfony2/tags">tags</a></p>

<h3 id="edited_30042014">EDITED 30/04/2014</h3>

<p>I love feedbacks:</p>
<blockquote>Good post but Ubiquitous Language is lacking. You don't "create" blog post, it is written. A post doesn't "have" an author etc
<small><a href='https://twitter.com/mathiasverraes'><img alt='@mathiasverraes' src='http://www.gravatar.com/avatar/3a7cb0c3c8d5864e2e72c49cafc3e4d5?s=25' />@mathiasverraes</a></small></blockquote>
<p>then I modified the stories and the behaviours.</p>

<h2 id="next">Next?</h2>

<p>We focused on the behaviors of the <code>Post</code> and <code>Author</code> entities during the specification, our <code>spec</code> are green now, but our <code>behat</code> stories are red.</p>

<p>In the next post, we will finish adding <strong>services</strong> using command patterns, we will describe how to create <strong>repositories</strong>, how to complete the project, how to create the <strong>business expectations over the application layer</strong> and not on the user interface, and how to works with Symfony2 in the <strong>Infrastructure layer</strong>.</p>

<p>Stay tuned and tweet if you want the next episode.</p>
    </article>
    <hr>
    <div id="related">
      <h3>Related Posts</h3>
      <ul class="posts">
      
      <li>
       <span>05 May 2014 &raquo;</span> <a href="/best-resources-about-symfony-tdd-bdd-ddd-methologies">(my) Best resources about methodologies on Symfony, PHP, DDD, BDD ...</a>
      </li>
      
      <li>
       <span>21 Mar 2014 &raquo;</span> <a href="/persist-the-money-doctrine-value-object">Persist the Money, Doctrine Value Object</a>
      </li>
      
      <li>
       <span>03 Dec 2013 &raquo;</span> <a href="/symfony2-rest-api-the-best-way-part-3">part 3 - Symfony2 API: the rest of REST</a>
      </li>
      
      </ul>
    </div>
    
    <div class="pagination">
        <ul class="pager span9">
            
            <li class="prev span3"><a href="/persist-the-money-doctrine-value-object" title="Persist the Money, Doctrine Value Object"><i class="icon-arrow-left"></i><br>
                Previous - Persist the Money, Doctrine Value Object</a></li>
            
            <li  class="span2 center"><a style=" width: 100%;" href="/index.html"><br>Archive</a></li>
            
            <li class="next span3"><a href="/best-resources-about-symfony-tdd-bdd-ddd-methologies" title="(my) Best resources about methodologies on Symfony, PHP, DDD, BDD ..."><i class="icon-arrow-right"></i> <br>Next - (my) Best resources about methodologies on Symfony, PHP, DDD, BDD ...</a>
            </li>
            
        </ul>
    </div>
    
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_developer = 1;
    var disqus_shortname = 'welcometothebundle'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




</div>
  
 



            </div>
        </div>
    </section>
</div>

<footer class="footer">
      <div class="container">
        <div class="span3 offset1">
            <ul class="nav nav-pills nav-stacked"> 
                <li class="nav-header">Open Source</li>                
                <li><a href="http://leaphly.org">leaphly <small>cart built around REST specs.</small></a></li>
                <li><a href="https://poser.pugx.org/">badge-poser <small>badges for composer</small></a></li>
                <li><a href="https://github.com/PUGX/godfather">godfather <small>php strategy pattern</small></a></li>
                <li><a href="https://github.com/liuggio/statsd-php-client">statsd-php-client <img class="pull-right" style="max-width:80px;margin-right:30px"  alt="Total Downloads" src="https://poser.pugx.org/liuggio/statsd-php-client/downloads.png"></a></li>
                <li><a href="https://github.com/liuggio/ExcelBundle">sf2 Excel bundle <img class="pull-right" style="max-width:80px;margin-right:30px" alt="Total Downloads" src="https://poser.pugx.org/liuggio/ExcelBundle/downloads.png"></a></li>
                 <li><a href="https://github.com/liuggio?tab=repositories"><small>more...</small></a></li>
            </ul>

        </div>



        <div  class="span2 offset1" >
            <ul class="nav nav-pills nav-stacked left">
            <li class="nav-header">Categories</li>
                <li><a href="/categories.html#tutorial-ref">
                    Tutorial
                </a></li>
                <li><a href="/categories.html#blah-blah-blah-ref">
                    Blah-blah-blah
                </a></li>
                <li><a href="/categories.html#post-ref">
                    Post
                </a></li>
                <li><a href="/categories.html#talk-ref">
                    Talk
                </a></li>
            </ul>
        </div>

        <div  class="span2 offset1" >
            <ul class="nav nav-pills nav-stacked"> 
            <li class="nav-header">Connect</li>
                <li><a href="https://github.com/liuggio" title="Giulio De Donato github projects"
                       target="_blank"
                       class="social"><img src="/assets/themes/readable-liuggio/img/github.png" width="13"> github</a></li>
                <li><a href="http://twitter.com/liuggio" title="Giulio De Donato twitter page"
                       target="_blank"
                       class="social"><i class="icon-twitter"></i> twitter</a></li>
                <li><a href="http://www.linkedin.com/profile/view?id=94597934"
                       title="Giulio De Donato Linkedin profile" target="_blank"
                       class="social">
                       <i class="icon-linkedin"></i> linkedin</a></li>
                <li><a href="http://www.slideshare.net/liuggio"
                       title="Giulio De Donato slideshare presentations" target="_blank"
                       class="social">
                       <img src="/assets/themes/readable-liuggio/img/slide.png" width="13"> slideshare
                       </a></li>
            </ul>
        </div>     
      </div>
      <p>© Giulio De Donato, 2013 — built with <a href="http://jekyllrb.com/">Jekyll.</a>
          <a href="http://welcometothebundle.com/feed.xml" title="feed" target="_blank">RSS feed</a>.
      </p>
    </footer>

<!-- /container -->
<script src="/assets/themes/readable-liuggio/bootstrap/js/jquery-1.8.3.min.js" type="text/javascript"></script>
<script src="/assets/themes/readable-liuggio/js/highlight.pack.js" type="text/javascript"></script>
<script src="/assets/themes/readable-liuggio/js/uitotop-jquery-plugin.js" type="text/javascript"></script>
<script src="/assets/themes/readable-liuggio/js/cloud.js" type="text/javascript"></script>


<script type="text/javascript">
    var links = document.links;
    for (var i = 0, linksLength = links.length; i < linksLength; i++) {
        if (links[i].hostname.replace("www.", "") != window.location.hostname.replace("www.", "") ) {
            links[i].target = '_blank';
        }
    }

    var links = document.links;
    for (var i = 0, linksLength = links.length; i < linksLength; i++) {

        if (links[i].href == 'http://www.slideshare.net/liuggio/rationally-boost-your-symfony2-application-with-caching-tips-and-monitoring') {

            //dirty solution in order to add slideshare frame into github Jekyll
            links[i].innerHTML = '<iframe src="http://www.slideshare.net/slideshow/embed_code/14625769?rel=0" width="512" height="421" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe><div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/liuggio/rationally-boost-your-symfony2-application-with-caching-tips-and-monitoring/?no" title="Rationally boost your symfony2 application with caching tips and monitoring" target="_blank">Rationally boost your symfony2 application with caching tips and monitoring</a></div>';
            break;
        } else if (links[i].href == 'http://www.slideshare.net/liuggio/its-all-about-behaviour-also-in-php') {
            links[i].innerHTML = '<iframe src="http://www.slideshare.net/slideshow/embed_code/27465974?rel=0" width="512" height="421" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe><div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/liuggio/its-all-about-behaviour-also-in-php/?no" title="It is all about behaviour also in php. PHP loves BDD." target="_blank">It is all about behaviour also in php. PHP loves BDD.</a></div>';
        } else if (links[i].href == 'http://www.slideshare.net/liuggio/design-pattern-symfony2') {
            links[i].innerHTML = '<div class="centered center"><iframe src="http://www.slideshare.net/slideshow/embed_code/27449969?rel=0" width="512" height="421" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe><div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/liuggio/design-pattern-symfony2/?no" title="Design pattern symfony2 - Nanos gigantium humeris insidentes" target="_blank">Design pattern Symfony2 - Nanos gigantium humeris insidentes</a></div></div>';
        } else if (links[i].href == 'http://www.slideshare.net/liuggio/caching-and-data-analysis-will-move-your-symfony2-application-to-the-next-level') {
            links[i].innerHTML = '<div class="centered center"><iframe src="http://www.slideshare.net/slideshow/embed_code/21395241?rel=0" width="512" height="421" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe><div style="margin-bottom:5px"> <strong> <a href="http://www.slideshare.net/liuggio/caching-and-data-analysis-will-move-your-symfony2-application-to-the-next-level?no" title="Caching and data analysis will move your Symfony2 application to the next level" target="_blank">Caching and data analysis will move your Symfony2 application to the next level</a></div></div>';
        }
    }

</script>
<script type="text/javascript">
  var analytics=analytics||[];analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);var r=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}},i=["identify","track","trackLink","trackForm","trackClick","trackSubmit","pageview","ab","alias","ready"];for(var s=0;s<i.length;s++)analytics[i[s]]=r(i[s])};
  analytics.load("wdoo4hzofo");
</script>

<script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37195869-1']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();

</script>


<script>
    $(function () { // document ready
        if (!!$('.sticky').offset()) { // make sure ".sticky" element exists
            var stickyTop = $('.sticky').offset().top; // returns number
            $(window).scroll(function () { // scroll event
                $('#sticky-pagination').show().removeClass("hidden");
                var windowTop = $(window).scrollTop(); // returns number
                if (stickyTop < windowTop) {
                    $('.sticky').css({ position:'fixed', top:0, right:0 });
                    $('.sticky').addClass("well");
                    $('.sticky .inner').show();

                }
                else {
                    $('.sticky').css('position', 'static');
                    $('.sticky').removeClass("well").addClass("span1");
                    $('.sticky .inner').hide();
                    $('#sticky-pagination').hide();
                }
            });
        }
    });
</script>

 <script>
        //syntax highlight
        $(document).ready(function() {
            $('pre code').each(function(i, e) {hljs.highlightBlock(e)});
        });
    </script>
<script type="text/javascript">
    $.fn.tagcloud.defaults = {
      size: {start: 10, end: 20, unit: 'px'},
      color: {start: '#CD4540', end: '9C2520'}
    };

    $(function () {
      $('ul.tag_box li a').tagcloud();
    });
</script>

<script>
$(document).ready(function() {
    $('h2, h3, h4, h5').each(function(i, e) {
        var a = '<a class="headerlink" href="#'+e.id+'" name="#'+e.id+'" title="Permalink to this headline">¶</a>';
        $(e).append(a);
    });
});

$().UItoTop();

</script>


</body>
</html>

